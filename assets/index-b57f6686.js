import{_ as R,u as q,b as z}from"./_plugin-vue_export-helper-c450468a.js";import{P as D}from"./m3u8-parser.es-f49a4a04.js";import{X as H,S as W,m as j,z as K,B as J,C as X,D as Y,E as Q,F as Z}from"./Player.vue_vue_type_style_index_0_scoped_e26564da_lang-dfeb7c19.js";import"./constants-e8ac43b8.js";import{d as U,r as a,w as A,g as ee,E as te,b as C,p as r,u as p,l as V,f as d,m as I,v as S,G as le,n as ae,B as oe,o as g,L as ne,M as se,j as re,k as F,K as ue,F as ie,q as ce,t as E,h as de}from"./runtime-dom.esm-bundler-75af5957.js";import{b as ve,I as pe,F as fe,a as me,T as _e,M as ye}from"./index-2462ac79.js";import{B as ge}from"./index-a7c0e6e7.js";import{I as he}from"./index-36d3bef5.js";const G="CONFIG";class be{async get(){const m=window.localStorage.getItem(G);if(!m)return{};try{return JSON.parse(m)}catch(o){return console.error("Failed to parse config:",o),{}}}async set(m){const u={...this.get(),...m};window.localStorage.setItem(G,JSON.stringify(u))}}const T=new be,Ce=w=>(ne("data-v-09c09e64"),w=w(),se(),w),we={key:0,class:"player-loading"},ke=Ce(()=>d("div",{class:"player-canvas"},null,-1)),xe={key:0,class:"player-progress"},Ie={class:"player-toolbar"},Se={class:"player-icon player-state"},Ve={class:"player-icon player-volume"},Fe={class:"player-volume-panel player-volume-panel-show"},$e={class:"player-toolbar-extra"},Pe={class:"player-icon player-fullscreen"},Te=U({__name:"player",props:{url:{},startTime:{},isLive:{type:Boolean}},emits:["timeupdate","ended"],setup(w,{emit:m}){const o=m,u=w;let t=null;const i=a({}),n=a(null),c=a(!1),_=a(!1),f=a(!1),h=a(!1),e=a(!1),v=a(0),s=a(0),b=a(0);function B(){c.value=!0}function M(l){e.value=!0,t.seek(l).finally(()=>{c.value=!1,e.value=!1})}function k(l){t.setVolume(l)}function O(){if(!n.value)return;const l=n.value;l.requestFullscreen().then(()=>{t.resize(l.clientWidth,l.clientHeight)}),_.value=!0}function $(){if(!n.value)return;const l=n.value;document.exitFullscreen().then(()=>{t.resize(l.clientWidth,l.clientHeight)}),_.value=!1}function P(){t.play().then(()=>{f.value=!0})}function L(){t.pause().then(()=>{f.value=!1})}async function x(){e.value=!0;const{url:l}=u;t.load(l).then(async()=>{if(s.value=Number(t.getDuration()),v.value=Number(t.getVolume()),t.on("time",y=>{c.value||(b.value=Number(y),o("timeupdate",b.value))}),t.on("ended",()=>{b.value=s.value,o("ended"),oe(()=>{x()})}),u.startTime&&b.value!==s.value&&await t.seek(u.startTime),t.play({video:!0,audio:!0}).then(()=>{f.value=!0}).finally(()=>{e.value=!1}),n.value){let y;n.value.onmousemove=()=>{h.value=!0,window.clearTimeout(y),y=window.setTimeout(()=>{h.value=!1},5*1e3)},h.value=!0,y=window.setTimeout(()=>{h.value=!1},5*1e3)}})}return A(()=>u.url,(l,y)=>{l!==y&&(e.value=!1,f.value=!1,v.value=0,b.value=0,s.value=0,t.stop().then(()=>{x()}))}),ee(async()=>{i.value=await T.get(),t=new H({container:n.value,enableHardware:i.value.enableHardware??!0,enableWebGPU:i.value.enableWebGPU??!1,enableAudioWebcodec:i.value.enableAudioWebcodec??!0,enableVideoWebcodec:i.value.enableVideoWebcodec??!0,loop:!1,jitterBufferMax:4,jitterBufferMin:1,lowLatency:!0,isLive:u.isLive}),x()}),te(()=>{t.destroy()}),(l,y)=>(g(),C("div",{ref_key:"playerRef",ref:n,class:"player"},[e.value?(g(),C("div",we,[r(p(j))])):V("",!0),ke,d("div",{class:ae(["player-controler",{"player-controler-show":h.value}])},[l.isLive?V("",!0):(g(),C("div",xe,[r(W,{modelValue:b.value,"onUpdate:modelValue":y[0]||(y[0]=N=>b.value=N),max:s.value,onChange:B,onOnAfterChange:M},null,8,["modelValue","max"])])),d("div",Ie,[d("div",Se,[I(r(p(K),{onClick:P},null,512),[[S,!f.value]]),I(r(p(J),{onClick:L},null,512),[[S,f.value]])]),d("div",Ve,[I(r(p(X),null,null,512),[[S,v.value]]),I(r(p(Y),null,null,512),[[S,!v.value]]),d("div",Fe,[r(W,{modelValue:v.value,"onUpdate:modelValue":y[1]||(y[1]=N=>v.value=N),max:3,step:.2,onChange:k},null,8,["modelValue"])])]),d("div",$e,[le(l.$slots,"toolbar-extra",{},void 0,!0),d("div",Pe,[I(r(p(Q),{onClick:O},null,512),[[S,!_.value]]),I(r(p(Z),{onClick:$},null,512),[[S,_.value]])])])])],2)],512))}});const Ue=R(Te,[["__scopeId","data-v-09c09e64"]]),Be=U({__name:"resource",setup(w,{expose:m}){const o=a({resourceUrl:""});function u(){return T.set(o.value)}function t(){T.get().then(i=>{o.value=i})}return t(),m({onConfirm:u}),(i,n)=>(g(),re(p(fe),{model:o.value,layout:"vertical"},{default:F(()=>[r(p(ve),{field:"name",tooltip:"资源地址仅支持“https”协议的m3u8格式的文件",label:"资源地址"},{default:F(()=>[r(p(pe),{modelValue:o.value.resourceUrl,"onUpdate:modelValue":n[0]||(n[0]=c=>o.value.resourceUrl=c),placeholder:"请输入资源地址..."},null,8,["modelValue"]),r(p(ge),{style:{"margin-left":"8px"},onClick:n[1]||(n[1]=c=>o.value.resourceUrl="https://resource-63t.pages.dev/test.m3u8")},{default:F(()=>[ue(" 测试 ")]),_:1})]),_:1})]),_:1},8,["model"]))}}),Le={class:"setting"},Ne=U({__name:"index",setup(w,{expose:m}){const o=a("1"),u=a(null),t=a(null),i=a(null);function n(){var _,f,h;let c;switch(o.value){case"1":c=(_=u.value)==null?void 0:_.onConfirm();break;case"2":c=(f=t.value)==null?void 0:f.onConfirm();break;case"3":c=(h=i.value)==null?void 0:h.onConfirm();break}return c}return m({onConfirm:n}),(c,_)=>(g(),C("div",Le,[r(p(_e),{"active-key":o.value,"onUpdate:activeKey":_[0]||(_[0]=f=>o.value=f),type:"rounded",direction:"vertical"},{default:F(()=>[r(p(me),{key:"1",title:"资源配置"},{default:F(()=>[r(Be,{ref_key:"resource",ref:u},null,512)]),_:1})]),_:1},8,["active-key"])]))}}),Ae={class:"main-layout"},Me={class:"sidebar-wrap"},Oe={class:"sidebar-inner"},We={class:"content-layout"},Ee={class:"video-wrap"},Ge={class:"video-inner"},Re=["onClick"],qe={class:"video-cover"},ze=["src"],De={key:0,class:"video-title"},He={key:1,class:"video-subtitle"},je={key:0,class:"fullscreen-player"},lt=U({__name:"index",setup(w){const m=q(),o=z(),u=a({}),t=a([]),i=a(""),n=a(!1);function c(){T.get().then(e=>{u.value=e})}async function _(){const{resourceUrl:e}=u.value;if(!e)return;const v=new D;await v.push(await(await fetch(e)).text()),v.end();const{segments:s}=v.manifest;t.value=s.map(({title:b,uri:B})=>{var $;const k=b.split(" ").reduce((P,L)=>{var l;const x=L.split("=");return P[x[0]]=((l=x[1])==null?void 0:l.replace(/"/g,""))||"",P},{});return{group:k["group-title"],title:k["tvg-name"]||k["tvg-id"],logo:($=k["tvg-logo"].split(","))==null?void 0:$[0],live:k.live==="true",uri:B}})}function f(){const e=de(Ne);ye.open({title:"配置",titleAlign:"start",width:720,closable:!1,hideCancel:!0,onBeforeOk(){var s;const v=(s=e==null?void 0:e.component)==null?void 0:s.exposed;if(v)return v.onConfirm().then(()=>{c()})},content:()=>e})}function h(e){o.push({query:{url:e.uri,live:String(e.live)}})}return A(()=>m.query,e=>{if(!e.url){i.value="";return}i.value=e.url,n.value=e.live==="true"},{immediate:!0}),A(u,()=>{_()}),c(),(e,v)=>(g(),C("div",Ae,[d("div",Me,[d("div",Oe,[r(p(he),{onClick:f})])]),d("div",We,[d("div",Ee,[d("div",Ge,[(g(!0),C(ie,null,ce(t.value,s=>(g(),C("div",{key:s.uri,class:"video-item",onClick:b=>h(s)},[d("div",qe,[d("img",{src:s.logo,alt:"VideoCover"},null,8,ze)]),s.title?(g(),C("div",De,E(s.title),1)):V("",!0),s.subtitle?(g(),C("div",He,E(s.subtitle),1)):V("",!0)],8,Re))),128))])])]),i.value?(g(),C("div",je,[r(Ue,{url:i.value,isLive:n.value},null,8,["url","isLive"])])):V("",!0)]))}});export{lt as default};
